<section class="container" role="main" aria-label="Listado de usuarios">
  <header class="toolbar">
    <mat-form-field appearance="outline">
      <mat-label>Buscar por nombre o email</mat-label>
      <input
        matInput
        (input)="store.query.set($any($event.target).value)"
        placeholder="Ej: Karley o @karina.biz"
      />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Compañía</mat-label>
      <mat-select
        [value]="store.company()"
        (valueChange)="store.company.set($event)"
        aria-label="Filtrar por compañía"
      >
        <mat-option *ngFor="let c of store.companies()" [value]="c">{{
          c === 'all' ? 'Todas' : c
        }}</mat-option>
      </mat-select>
    </mat-form-field>
  </header>

  <ul class="grid" role="list">
    <li
      *ngFor="let u of store.paged(); trackBy: track"
      class="card"
      tabindex="0"
      (click)="open(u)"
      (keydown.enter)="open(u)"
      aria-label="Abrir detalles de {{ u.name }}"
    >
      <h3>{{ u.name }}</h3>
      <p><mat-icon aria-hidden="true">person</mat-icon> {{ u.username }}</p>
      <p><mat-icon aria-hidden="true">email</mat-icon> {{ u.email }}</p>
      <p><mat-icon aria-hidden="true">apartment</mat-icon> {{ u.company.name }}</p>
    </li>
  </ul>

  <footer class="paginator" aria-label="Paginación">
    <button mat-stroked-button (click)="prev()" [disabled]="store.page() === 1">Anterior</button>
    <span>Página {{ store.page() }}</span>
    <button mat-stroked-button (click)="next()" [disabled]="store.paged().length < store.pageSize">
      Siguiente
    </button>
  </footer>
</section>

<mat-drawer-container class="drawer" *ngIf="store.selectedUser()" [hasBackdrop]="true">
  <mat-drawer
    #side
    mode="over"
    position="end"
    [opened]="store.selectedUser() !== null"
    (closedStart)="store.closeSidebar()"
    role="dialog"
    aria-label="Detalle de usuario"
  >
    <ng-container *ngIf="store.selectedUser() as user">
      <header class="drawer-header">
        <h2 id="user-title">{{ user.name }}</h2>
        <button mat-icon-button (click)="side.close()" aria-label="Cerrar panel">
          <mat-icon>close</mat-icon>
        </button>
      </header>
      <div class="drawer-content" tabindex="0" [attr.aria-labelledby]="'user-title'">
        <h3>Información</h3>
        <p><b>Ciudad:</b> {{ user.address.city }}</p>
        <p><b>Código Postal:</b> {{ user.address.zipcode }}</p>
        <p><b>Teléfono:</b> {{ user.phone }}</p>
        <p><b>Email:</b> {{ user.email }}</p>
        <p><b>Compañía:</b> {{ user.company.name }}</p>
        <p><b>Website:</b> {{ user.website }}</p>

        <h3>Últimas 5 publicaciones</h3>
        <mat-nav-list>
          <a mat-list-item *ngFor="let p of store.lastPosts()">
            <div matListItemTitle>{{ p.title }}</div>
            <div matListItemLine>{{ p.body }}</div>
          </a>
        </mat-nav-list>
      </div>
    </ng-container>
  </mat-drawer>
</mat-drawer-container>
